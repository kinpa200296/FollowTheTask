@model FollowTheTask.Models.TrackedTasks.TrackedTaskModel

@if (Model != null)
{
    <script>
        function onCompleteSuccess() {
            if ($('#tempdiv')[0].innerText == 'Задача сдана. Обновите страницу') {
                document.location.href = '@Url.Action("TasksDetails", "Managers",
                    new { username = Model.Manager.UserName, id = Model.Id }, null)';
            }
        }
    </script>

    if (Model.IsFinished)
    {
        <span class="text-success">@ViewBag.Message</span>
    }
    else
    {
        <div class="form-horizontal">
            @using (Ajax.BeginForm("TasksComplete", "Managers", new { username = User.Identity.Name, id = Model.Id }, new AjaxOptions
            {
                UpdateTargetId = "tempdiv",
                OnSuccess = "onCompleteSuccess"
            }))
            {
                @Html.AntiForgeryToken()

                @Html.ValidationSummary(true, null, new { @class = "text-danger" })

                @Html.HiddenFor(m => m.Title)
                @Html.HiddenFor(m => m.Description)

                <div class="form-group">
                    <div class="col-md-4">@Html.LabelFor(m => m.HoursSpent, null, new { @class = "control-label" })</div>
                    <div class="col-md-8">
                        @Html.EditorFor(m => m.HoursSpent, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(m => m.HoursSpent, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    <input type="submit" value="Завершить задачу" class="btn btn-primary col-md-offset-4" />
                    <input type="button" value="Отменить" class="btn btn-default" onclick=" $('#tempdiv')[0].innerHTML = '' " />
                </div>
            }
        </div>
    }
}
else
{
    <span class="text-danger">@ViewBag.ErrorMessage</span>
}
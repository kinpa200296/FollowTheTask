@model IEnumerable<FollowTheTask.Models.Managers.ManagerModel>

@{
    ViewBag.Title = "Список менеджеров";
}

<h2>@ViewBag.Title</h2>

@if (User.IsInRole("manager") && Model.All(x => x.UserName != User.Identity.Name))
{
    <p class="row">

        <div id="creationMessage">
            <h4 class="text-warning">Вашего аккаунта менеджера не создано. Однако это можно исправить.</h4>
        </div>

        @using (Ajax.BeginForm("Create", "Managers", new AjaxOptions
        {
            UpdateTargetId = "creationMessage",
            OnSuccess = "$('#creationButton')[0].remove()"
        }))
        {
            @Html.AntiForgeryToken()
            
            <input id="creationButton" type="submit" value="Исправить" class="btn btn-warning"/>
        }
    </p>
}

<div class="row">
    <div class="col-md-12">
        <table class="table">
            <tr class="row">
                <th class="col-md-2">Имя пользователя</th>
                <th class="col-md-2">E-mail адрес</th>
                <th class="col-md-1">Имя</th>
                <th class="col-md-1">Фамилия</th>
                <th class="col-md-2">Задачи</th>
                <th class="col-md-2">Исполнители</th>
                <th class="col-md-2">Действия</th>
            </tr>
            @foreach (var manager in Model)
            {
                <tr class="row">
                    <td>@Html.DisplayFor(m => manager.UserName)</td>
                    <td>@Html.DisplayFor(m => manager.Email)</td>
                    <td>@Html.DisplayFor(m => manager.FirstName)</td>
                    <td>@Html.DisplayFor(m => manager.LastName)</td>
                    <td>
                        @foreach (var task in manager.TrackedTasks)
                        {
                            <p>@Html.DisplayFor(m => task.Title)</p>
                        }
                    </td>
                    <td>
                        @foreach (var task in manager.Workers)
                        {
                            <p>@Html.DisplayFor(m => task.UserName)</p>
                        }
                    </td>
                    <td>
                        <ul class="nav nav-pills">
                            <li>@Html.ActionLink("Подробности", "Details", "Managers", new {username = manager.UserName}, null)</li>
                        </ul>
                    </td>
                </tr>
            }
        </table>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/scripts/jquery-1.10.2.min.js")
    @Scripts.Render("~/scripts/jquery.unobtrusive-ajax.min.js")
}
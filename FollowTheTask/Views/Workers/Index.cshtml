@model IEnumerable<FollowTheTask.Models.Workers.WorkerModel>

@{
    ViewBag.Title = "Список исполнителей";
}

<h2>@ViewBag.Title</h2>

@if (User.IsInRole("worker") && Model.All(x => x.UserName != User.Identity.Name))
{
    <p class="row">

        <div id="creationMessage">
            <h4 class="text-warning">Вашего аккаунта исполнителя не создано. Однако это можно исправить.</h4>
        </div>

        @using (Ajax.BeginForm("Create", "Workers", new AjaxOptions
        {
            UpdateTargetId = "creationMessage",
            OnSuccess = "$('#creationButton')[0].remove()"
        }))
        {
            @Html.AntiForgeryToken()

            <input id="creationButton" type="submit" value="Исправить" class="btn btn-warning" />
        }
    </p>
}

<div class="row">
    <div class="col-md-12">
        <table class="table">
            <tr class="row">
                <th class="col-md-2">Имя пользователя</th>
                <th class="col-md-2">E-mail адрес</th>
                <th class="col-md-1">Имя</th>
                <th class="col-md-1">Фамилия</th>
                <th class="col-md-2">Подзадачи</th>
                <th class="col-md-2">Менеджер</th>
                <th class="col-md-2">Действия</th>
            </tr>
            @foreach (var worker in Model)
            {
                <tr class="row">
                    <td>@Html.DisplayFor(m => worker.UserName)</td>
                    <td>@Html.DisplayFor(m => worker.Email)</td>
                    <td>@Html.DisplayFor(m => worker.FirstName)</td>
                    <td>@Html.DisplayFor(m => worker.LastName)</td>
                    <td>
                        @foreach (var quest in worker.Quests)
                        {
                            <p>@Html.DisplayFor(m => quest.Title)</p>
                        }
                    </td>
                    <td>@Html.DisplayFor(m => worker.Manager.UserName)</td>
                    <td>
                        <ul class="nav nav-pills">
                            <li>@Html.ActionLink("Подробности", "Details", "Workers", new { username = worker.UserName }, null)</li>
                        </ul>
                    </td>
                </tr>
            }
        </table>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/scripts/jquery-1.10.2.min.js")
    @Scripts.Render("~/scripts/jquery.unobtrusive-ajax.min.js")
}